@using Batch.ViewModels
@model CrearUsuarioViewModel
<div class="card p-4 shadow-sm">

    <div class="mb-3">
        <label class="form-label">Nombre completo</label>
        <input id="nombre" class="form-control" />
    </div>

    <div class="mb-3">
        <label class="form-label">Usuario (login)</label>
        <input id="usuarioLogin" class="form-control" />
    </div>

    <div class="mb-3">
        <label class="form-label">Contraseña</label>
        <input id="password" type="password" class="form-control" />
    </div>

    <div class="mb-3">
        <label class="form-label">Rol</label>
        <select id="rolId" class="form-select">
            <option value="">Seleccione un rol</option>
            @foreach (var rol in Model.RolesDisponibles)
            {
                <option value="@rol.Id">@rol.Nombre</option>
            }
        </select>
    </div>

    <button class="btn btn-primary" onclick="crearUsuario()">Crear Usuario</button>
</div>
@if (ViewBag.Debug != null)
{
    <div class="alert alert-warning">
        @ViewBag.Debug
    </div>
}

@section Scripts{
    <script>
                     function crearUsuario() {

            const data = {
                nombre: document.getElementById("nombre").value,
                usuarioLogin: document.getElementById("usuarioLogin").value,
                password: document.getElementById("password").value,
                rolId: parseInt(document.getElementById("rolId").value)
            };

            fetch('/Usuario/Crear', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(r => r.json())
            .then(res => {

                if (res.success) {
                    // ✅ Guardar mensaje para mostrarlo después de recargar
                    localStorage.setItem("toastMessage", res.message);
                    localStorage.setItem("toastType", "success");

                    location.reload();
                    return;
                }

                // ✅ Error: NO recargar
                mostrarToast(res.message || "Error al crear usuario", "danger");
            })
            .catch(err => {
                console.error(err);
                mostrarToast("Error de red", "danger");
            });
        }
    </script>

    <script>
                document.addEventListener("DOMContentLoaded", function () {
            const msg = localStorage.getItem("toastMessage");
            const type = localStorage.getItem("toastType");

            if (msg) {
                mostrarToast(msg, type || "info");

                localStorage.removeItem("toastMessage");
                localStorage.removeItem("toastType");
            }
        });
    </script>

    
}